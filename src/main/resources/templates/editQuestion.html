<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>Edyjca pytan</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<link rel="stylesheet" th:href="@{/js/jquery-ui.min.css}"
	href="../../ja/jquery-ui.min.css" />
<link rel="stylesheet" th:href="@{/css/main.css}"
	href="../../css/main.css" />

<script src="../../js/jquery-1.4.1.min.js"></script>
<script src="../../js/jquery-ui.min.js"></script>
<script>
	function send(data) {

		$.ajax({
			url : "/quest/delete",
			type : "POST",
			contentType : "application/json",
			data : JSON.stringify(data),
			success : function(data) {
				location.reload();
			}
		});
	}
	
	$(document).ready(function() {

		$("#editDialog").dialog({
			autoOpen : true,
		});

		$("input[type=button]").click(function() {
			edit($(this).attr("name"));
		});

		$("#delete").click(function() {
			var array = [];
			$('input[type=checkbox]').each(function() {
				if ($(this).is(':checked')) {
					array.push({
						id : $(this).attr("name")
					});
				}
			});

			var conf = confirm("Czy na pewno usunąć te pytania ?");
			if (conf == true) {
				send(array);
			} else {
			}
		});

	});

	$("#btn").click(function() {
		javascript: self.close();
		self.close();
	});

	$(window).load(function() {
		if ($("#err").val() != "") {
			$("#editDialog").dialog("open");
		}
	});
	
	function edit(questId) {
		$.ajax({
			url : "/quest/edit/" + questId,
			type : "GET",
			success : function(data) {
				document.getElementById("editDialog").innerHTML = data;
				$("#editDialog").dialog("open");
			}
		});
	}
</script>
</head>
<body>
	<div height="100px" id="errorDiv" align="right">
		<p id="err" th:text="${error}" th:value="${error}" style="color: red;"></p>
	</div>

	<div id="editDialog" title="Edytuj">
		<form action="#" th:action="@{/quest/edit}" th:object="${questions}"
			method="post">

			<div th:each="quest : ${questions}" th:field="*{questions}">

				<input type="text" th:name="id" th:value="${quest.id}"
					style="display: none"></input> Pytanie: <input type="text"
					th:name="content" th:value="${quest.content}"
					th:class="${#fields.hasErrors('content')}? 'error'"></input>

				Punkty: <input type="number" th:name="points"
					th:value="${quest.points}"
					th:class="${#fields.hasErrors('points')}? 'error'"></input> <input
					type="text" th:name="answerA" th:value="${quest.answerA}"
					th:class="${#fields.hasErrors('answerA')}? 'error'"></input> <input
					type="radio" th:name="correctAnswer" value="answerA"
					th:checked="${quest.correctAnswer}=='answerA'"></input> <input
					type="text" th:name="answerB" th:value="${quest.answerB}"
					th:class="${#fields.hasErrors('answerB')}? 'error'"></input> <input
					type="radio" th:name="correctAnswer" value="answerB"
					th:checked="${quest.correctAnswer}=='answerB'"></input> <input
					type="text" th:name="answerC" th:value="${quest.answerC}"
					th:class="${#fields.hasErrors('answerC')}? 'error'"></input> <input
					th:type="radio" th:name="correctAnswer" th:value="answerC"
					th:checked="${quest.correctAnswer}=='answerC'"></input> <input
					type="text" th:name="answerD" th:value="${quest.answerD}"
					th:class="${#fields.hasErrors('answerD')}? 'error'"></input> <input
					th:type="radio" th:name="correctAnswer" th:value="answerD"
					th:checked="${quest.correctAnswer}=='answerD'"></input> Przedmiot:
				<select name="courseGenere">

					<option value="Algebra">Algebra</option>
					<option value="Analiza">Analiza</option>
					<option value="Informatyka">Analiza</option>
					<option value="Fizyka">Analiza</option>
				</select>
			</div>
			<button id="btn" class="button" type="submit">Edytuj</button>
		</form>
	</div>

	<form id="testForm" action="#" method="get">
		<table>
			<tr th:each="quest : ${quests}">
			<tr>
				<th>Pytanie:</th>

				<td th:text="${quest.content}"></td>
				<td><input type="checkbox" th:name="${quest.id}"></input></td>
				<td><input class="btn" type="button" th:name="${quest.id}"
					value="edytuj"></input></td>

			</tr>

			<tr>
				<td th:text="${quest.answerA}"></td>
				<td><input th:id="${quest.correctAnswer}" disabled="disabled"
					type="radio" th:name="${quest.id}"
					th:checked="${quest.correctAnswer}=='answerA' ? true : false" /></td>
			</tr>
			<tr>
				<td th:text="${quest.answerB}"></td>
				<td><input th:id="${quest.correctAnswer}" disabled="disabled"
					type="radio" th:name="${quest.id}"
					th:checked="${quest.correctAnswer}=='answerB' ? true : false" /></td>
			</tr>
			<tr>
				<td th:text="${quest.answerC}"></td>
				<td><input th:id="${quest.correctAnswer}" disabled="disabled"
					type="radio" th:name="${quest.id}"
					th:checked="${quest.correctAnswer}=='answerC' ? true : false" /></td>
			</tr>
			<tr>
				<td th:text="${quest.answerD}"></td>
				<td><input th:id="${quest.correctAnswer}" disabled="disabled"
					type="radio" th:name="${quest.id}"
					th:checked="${quest.correctAnswer}=='answerD' ? true : false" /></td>
			</tr>
			</tr>
		</table>
		<button class="button" id="delete" type="button">Usun</button>

	</form>
	<a href="/logout" th:href="@{/logout}"><div class="button">Wyloguj</div></a>
</body>
</html>